import{r as i,c as Te,a as me,j as c,b as ke,f as Ne,d as Re,e as Oe,h as We,i as $e}from"./index-jBnxowNn.js";import{u as ee,h as Ae,_ as He,D as _e,V as S,J as he,K as xe,X as Le,Y as U,Z as Ie,i as fe,z as de,y as De,x as Ve}from"./Logo-O-Gnbwzv.js";import{a as Be,u as _,O as Ue}from"./hooks-F80qMT0O.js";const L=new S,te=new S,Ze=new S;function Ge(e,t,s){const o=L.setFromMatrixPosition(e.matrixWorld);o.project(t);const r=s.width/2,n=s.height/2;return[o.x*r+r,-(o.y*n)+n]}function Je(e,t){const s=L.setFromMatrixPosition(e.matrixWorld),o=te.setFromMatrixPosition(t.matrixWorld),r=s.sub(o),n=t.getWorldDirection(Ze);return r.angleTo(n)>Math.PI/2}function Ke(e,t,s,o){const r=L.setFromMatrixPosition(e.matrixWorld),n=r.clone();n.project(t),s.setFromCamera(n,t);const l=s.intersectObjects(o,!0);if(l.length){const u=l[0].distance;return r.distanceTo(s.ray.origin)<u}return!0}function Xe(e,t){if(t instanceof he)return t.zoom;if(t instanceof xe){const s=L.setFromMatrixPosition(e.matrixWorld),o=te.setFromMatrixPosition(t.matrixWorld),r=t.fov*Math.PI/180,n=s.distanceTo(o);return 1/(2*Math.tan(r/2)*n)}else return 1}function Ye(e,t,s){if(t instanceof xe||t instanceof he){const o=L.setFromMatrixPosition(e.matrixWorld),r=te.setFromMatrixPosition(t.matrixWorld),n=o.distanceTo(r),l=(s[1]-s[0])/(t.far-t.near),u=s[1]-l*t.far;return Math.round(l*n+u)}}const Q=e=>Math.abs(e)<1e-10?0:e;function ge(e,t,s=""){let o="matrix3d(";for(let r=0;r!==16;r++)o+=Q(t[r]*e.elements[r])+(r!==15?",":")");return s+o}const qe=(e=>t=>ge(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Qe=(e=>(t,s)=>ge(t,e(s),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function et(e){return e&&typeof e=="object"&&"current"in e}const tt=i.forwardRef(({children:e,eps:t=.001,style:s,className:o,prepend:r,center:n,fullscreen:l,portal:u,distanceFactor:a,sprite:w=!1,transform:h=!1,occlude:f,onOcclude:g,castShadow:Z,receiveShadow:x,material:O,geometry:v,zIndexRange:d=[16777271,0],calculatePosition:G=Ge,as:pe="div",wrapperClass:J,pointerEvents:se="auto",...C},ne)=>{const{gl:re,camera:y,scene:oe,size:b,raycaster:ve,events:be,viewport:Me}=ee(),[p]=i.useState(()=>document.createElement(pe)),K=i.useRef(),j=i.useRef(null),ie=i.useRef(0),I=i.useRef([0,0]),W=i.useRef(null),X=i.useRef(null),N=(u==null?void 0:u.current)||be.connected||re.domElement.parentNode,z=i.useRef(null),D=i.useRef(!1),V=i.useMemo(()=>f&&f!=="blending"||Array.isArray(f)&&f.length&&et(f[0]),[f]);i.useLayoutEffect(()=>{const M=re.domElement;f&&f==="blending"?(M.style.zIndex=`${Math.floor(d[0]/2)}`,M.style.position="absolute",M.style.pointerEvents="none"):(M.style.zIndex=null,M.style.position=null,M.style.pointerEvents=null)},[f]),i.useLayoutEffect(()=>{if(j.current){const M=K.current=Te(p);if(oe.updateMatrixWorld(),h)p.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const m=G(j.current,y,b);p.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${m[0]}px,${m[1]}px,0);transform-origin:0 0;`}return N&&(r?N.prepend(p):N.appendChild(p)),()=>{N&&N.removeChild(p),M.unmount()}}},[N,h]),i.useLayoutEffect(()=>{J&&(p.className=J)},[J]);const ae=i.useMemo(()=>h?{position:"absolute",top:0,left:0,width:b.width,height:b.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:n?"translate3d(-50%,-50%,0)":"none",...l&&{top:-b.height/2,left:-b.width/2,width:b.width,height:b.height},...s},[s,n,l,b,h]),je=i.useMemo(()=>({position:"absolute",pointerEvents:se}),[se]);i.useLayoutEffect(()=>{if(D.current=!1,h){var M;(M=K.current)==null||M.render(i.createElement("div",{ref:W,style:ae},i.createElement("div",{ref:X,style:je},i.createElement("div",{ref:ne,className:o,style:s,children:e}))))}else{var m;(m=K.current)==null||m.render(i.createElement("div",{ref:ne,style:ae,className:o,children:e}))}});const R=i.useRef(!0);Ae(M=>{if(j.current){y.updateMatrixWorld(),j.current.updateWorldMatrix(!0,!1);const m=h?I.current:G(j.current,y,b);if(h||Math.abs(ie.current-y.zoom)>t||Math.abs(I.current[0]-m[0])>t||Math.abs(I.current[1]-m[1])>t){const F=Je(j.current,y);let E=!1;V&&(Array.isArray(f)?E=f.map(T=>T.current):f!=="blending"&&(E=[oe]));const $=R.current;if(E){const T=Ke(j.current,y,ve,E);R.current=T&&!F}else R.current=!F;$!==R.current&&(g?g(!R.current):p.style.display=R.current?"block":"none");const B=Math.floor(d[0]/2),Pe=f?V?[d[0],B]:[B-1,0]:d;if(p.style.zIndex=`${Ye(j.current,y,Pe)}`,h){const[T,le]=[b.width/2,b.height/2],Y=y.projectionMatrix.elements[5]*le,{isOrthographicCamera:ue,top:Se,left:we,bottom:Ce,right:Ee}=y,ze=qe(y.matrixWorldInverse),Fe=ue?`scale(${Y})translate(${Q(-(Ee+we)/2)}px,${Q((Se+Ce)/2)}px)`:`translateZ(${Y}px)`;let k=j.current.matrixWorld;w&&(k=y.matrixWorldInverse.clone().transpose().copyPosition(k).scale(j.current.scale),k.elements[3]=k.elements[7]=k.elements[11]=0,k.elements[15]=1),p.style.width=b.width+"px",p.style.height=b.height+"px",p.style.perspective=ue?"":`${Y}px`,W.current&&X.current&&(W.current.style.transform=`${Fe}${ze}translate(${T}px,${le}px)`,X.current.style.transform=Qe(k,1/((a||10)/400)))}else{const T=a===void 0?1:Xe(j.current,y)*a;p.style.transform=`translate3d(${m[0]}px,${m[1]}px,0) scale(${T})`}I.current=m,ie.current=y.zoom}}if(!V&&z.current&&!D.current)if(h){if(W.current){const m=W.current.children[0];if(m!=null&&m.clientWidth&&m!=null&&m.clientHeight){const{isOrthographicCamera:F}=y;if(F||v)C.scale&&(Array.isArray(C.scale)?C.scale instanceof S?z.current.scale.copy(C.scale.clone().divideScalar(1)):z.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):z.current.scale.setScalar(1/C.scale));else{const E=(a||10)/400,$=m.clientWidth*E,B=m.clientHeight*E;z.current.scale.set($,B,1)}D.current=!0}}}else{const m=p.children[0];if(m!=null&&m.clientWidth&&m!=null&&m.clientHeight){const F=1/Me.factor,E=m.clientWidth*F,$=m.clientHeight*F;z.current.scale.set(E,$,1),D.current=!0}z.current.lookAt(M.camera.position)}});const ce=i.useMemo(()=>({vertexShader:h?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[h]);return i.createElement("group",He({},C,{ref:j}),f&&!V&&i.createElement("mesh",{castShadow:Z,receiveShadow:x,ref:z},v||i.createElement("planeGeometry",null),O||i.createElement("shaderMaterial",{side:_e,vertexShader:ce.vertexShader,fragmentShader:ce.fragmentShader})))});let A=0;const st=Le(e=>(U.onStart=(t,s,o)=>{e({active:!0,item:t,loaded:s,total:o,progress:(s-A)/(o-A)*100})},U.onLoad=()=>{e({active:!1})},U.onError=t=>e(s=>({errors:[...s.errors,t]})),U.onProgress=(t,s,o)=>{s===o&&(A=o),e({active:!0,item:t,loaded:s,total:o,progress:(s-A)/(o-A)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),H=new S;function P(e,t,s,o,r,n){const l=2*Math.PI*r/4,u=Math.max(n-2*r,0),a=Math.PI/4;H.copy(t),H[o]=0,H.normalize();const w=.5*l/(l+u),h=1-H.angleTo(e)/a;return Math.sign(H[s])===1?h*w:u/(l+u)+w+w*(1-h)}class nt extends Ie{constructor(t=1,s=1,o=1,r=2,n=.1){if(r=r*2+1,n=Math.min(t/2,s/2,o/2,n),super(1,1,1,r,r,r),r===1)return;const l=this.toNonIndexed();this.index=null,this.attributes.position=l.attributes.position,this.attributes.normal=l.attributes.normal,this.attributes.uv=l.attributes.uv;const u=new S,a=new S,w=new S(t,s,o).divideScalar(2).subScalar(n),h=this.attributes.position.array,f=this.attributes.normal.array,g=this.attributes.uv.array,Z=h.length/6,x=new S,O=.5/r;for(let v=0,d=0;v<h.length;v+=3,d+=2)switch(u.fromArray(h,v),a.copy(u),a.x-=Math.sign(a.x)*O,a.y-=Math.sign(a.y)*O,a.z-=Math.sign(a.z)*O,a.normalize(),h[v+0]=w.x*Math.sign(u.x)+a.x*n,h[v+1]=w.y*Math.sign(u.y)+a.y*n,h[v+2]=w.z*Math.sign(u.z)+a.z*n,f[v+0]=a.x,f[v+1]=a.y,f[v+2]=a.z,Math.floor(v/Z)){case 0:x.set(1,0,0),g[d+0]=P(x,a,"z","y",n,o),g[d+1]=1-P(x,a,"y","z",n,s);break;case 1:x.set(-1,0,0),g[d+0]=1-P(x,a,"z","y",n,o),g[d+1]=1-P(x,a,"y","z",n,s);break;case 2:x.set(0,1,0),g[d+0]=1-P(x,a,"x","z",n,t),g[d+1]=P(x,a,"z","x",n,o);break;case 3:x.set(0,-1,0),g[d+0]=1-P(x,a,"x","z",n,t),g[d+1]=1-P(x,a,"z","x",n,o);break;case 4:x.set(0,0,1),g[d+0]=1-P(x,a,"x","y",n,t),g[d+1]=1-P(x,a,"y","x",n,s);break;case 5:x.set(0,0,-1),g[d+0]=P(x,a,"x","y",n,t),g[d+1]=1-P(x,a,"y","x",n,s);break}}}const ye=({position:e,texture:t,index:s})=>{const[o,r]=i.useState(!1),n=i.useRef(null),l=i.useMemo(()=>new S,[]),u=o?"#CBC3FF":"#FFF";i.useEffect(()=>{document.body.style.cursor=o?"url(/icons/cursor-hand.svg) 5 5, auto":"url(/icons/cursor-arrow.svg) 5 5, auto"},[o]),i.useEffect(()=>{l.set(e.x*2,e.y,e.z*2),n.current.lookAt(l)},[e,l]);const a=me(),w=()=>{a(`/element/${s}`)},h=new nt(1,1,1,10,.1);return c.jsx("mesh",{ref:n,geometry:h,name:(s+1).toString(),position:e,onPointerOver:()=>r(!0),onPointerOut:()=>r(!1),onDoubleClick:w,children:c.jsx("meshBasicMaterial",{toneMapped:!1,color:u,map:t})})},rt=({elements:e})=>{const{camera:t}=ee(),s=fe(de,Array.from({length:118},(l,u)=>`/textures/textures_elements_${u}.png`));let o=Math.round(118/16/2)-1,r=-8;t.position.set(0,0,-15);const n=i.useMemo(()=>{const l=[];for(let u=0;u<e.length;u++)r>8&&(o--,r=-8),l.push(c.jsx(ye,{position:new S(r*1.8,o*2.5,0),texture:s[+e[u].atomicNumber],index:+e[u].atomicNumber},u)),r++;return l},[e,s]);return c.jsx(c.Fragment,{children:n})},ot=({elements:e})=>{const{camera:t}=ee(),s=fe(de,Array.from({length:118},(r,n)=>`/textures/textures_elements_${n}.png`));t.position.set(0,0,-15);const o=i.useMemo(()=>{const r=[];for(let n=0;n<e.length;n++){const l=n*.175+Math.PI,u=-(n*.05)+3;r.push(c.jsx(ye,{position:new S().setFromCylindricalCoords(8,l,u),texture:s[+e[n].atomicNumber-1],index:+e[n].atomicNumber},n))}return r},[e,s]);return c.jsx(c.Fragment,{children:o})},it="_filter_16hra_1",at={filter:it},ct=({options:e,id:t,value:s})=>{const o=Be(),r=n=>{const l=n.target.value;o(ke({key:t,value:l}))};return c.jsxs("select",{name:t,id:t,value:s,onChange:r,className:`${at.filter} text-white mt-4 px-2 py-2 border-solid border-round-lg hover:border-primary active:text-primary`,children:[c.jsx("option",{value:"",children:t}),e&&e.map((n,l)=>c.jsx("option",{value:n.value,children:n.label},l))]})},lt=()=>{const e=_(Ne),t=_(Re);return c.jsx("section",{style:{position:"absolute",zIndex:2,bottom:0},className:"mb-4 w-full flex justify-content-center px-4 gap-2",children:Object.entries(e).map(s=>c.jsx(ct,{options:s[1],id:s[0],value:t[s[0]]},s[0]))})},ut="_toggleSwitch_mwvr2_1",mt="_toggleSlider_mwvr2_14",q={toggleSwitch:ut,toggleSlider:mt},ht=({onToggle:e})=>{const[t,s]=i.useState(!1),o=()=>{const r=!t;s(r),e(r)};return c.jsx("div",{className:q.toggle,children:c.jsxs("label",{className:q.toggleSwitch,children:[c.jsx("input",{type:"checkbox",checked:t,onChange:o}),c.jsx("span",{className:q.toggleSlider})]})})},xt=({onTypeChange:e,type:t})=>{const s=me(),o=()=>{s("/")},r=()=>{if(t==="Helix"){e("Table");return}e("Helix")};return c.jsxs("header",{className:"p-4 flex justify-content-between w-full absolute z-5",children:[c.jsx(De,{size:"medium",onClick:o}),c.jsxs("div",{className:"flex align-items-center",children:[c.jsx("p",{className:"text-white text-sm mr-2",children:t}),c.jsx(ht,{onToggle:r})]})]})},ft=()=>{const{progress:e}=st();return c.jsxs(tt,{center:!0,className:"text-primary text-xl",children:[Math.floor(e),"%"]})},pt=()=>{const[e,t]=i.useState("Helix"),s=_(Oe),o=_(We),r=_($e),n=l=>{t(l)};return c.jsxs("div",{children:[c.jsx(xt,{type:e,onTypeChange:n}),c.jsx(lt,{}),s==="loading"&&c.jsx("p",{className:"text-primary m-auto",children:"Load Elements..."}),s==="failed"&&c.jsx("p",{children:o}),s==="succeeded"&&c.jsx(Ve,{style:{position:"absolute",zIndex:1},children:c.jsxs(i.Suspense,{fallback:c.jsx(ft,{}),children:[e==="Helix"&&c.jsx(ot,{elements:r}),e==="Table"&&c.jsx(rt,{elements:r}),c.jsx(Ue,{minPolarAngle:Math.PI/2,maxPolarAngle:Math.PI/2}),c.jsx("ambientLight",{color:13410292,intensity:1})]})})]})};export{pt as default};
